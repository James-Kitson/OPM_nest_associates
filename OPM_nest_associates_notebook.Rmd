---
title: "R Notebook"
output: html_notebook
---

#OPM Sanger processing

###This [R Markdown](http://rmarkdown.rstudio.com) notebook has been written to outline the steps taken to quality trim and merge sanger sequences for OAK Processionary Moth nest associates. The code used here draws heavily on the [sangeranalyseR](https://github.com/roblanf/sangeranalyseR) vignette provided by [Robert Lanfear](http:www.robertlanfear.com).

##Part one - Set up the libraries we need.
We're going to be using a library called [sangeranalyseR](https://github.com/roblanf/sangeranalyseR) so that the process is more documented and reproducible compared to the usual trimming and mergeing by eye performed using Geneious, FinchTV or similar programs. There are quite a few required libraries here but a script called [installs_for_sangerseqR.R](https://github.com/James-Kitson/OPM_nest_associates/blob/master/installs_for_sangerseqR.R) contains all the relevant commands.

```{r}
#Load the library we need
library(sangerseqR)
```

We need to set a path to the sequences, read them in and then process them into sangerseqR format.
```{r}
seq.filepath<-"ab1_sequences/150413-51_A01_OPMA1_HCO2198puc.ab1"
seq.abif<-read.abif(seq.filepath)
seq.sanger<-sangerseq(seq.abif)
```

Next we'll trim low quality reads. This is mostly primers at the start of sequences but also weak signal at the end. It should also kill any failed sequences.
```{r}
trims<-trim.mott(seq.abif)
trims
```

We can compare the trimmed and untrimmed sequences.
```{r}
seq.untrimmed = seq.abif@data$PBAS.2
seq.trimmed = substring(seq.untrimmed, trims$start, trims$finish)
seq.untrimmed
seq.trimmed
```

We also need to find any secondary peaks in our trace (contamination/background noise or possibly heterozygous sequences if relevant).
```{r}
sp = secondary.peaks(seq.sanger)
sp$secondary.peaks
sp$read
sp = secondary.peaks(seq.sanger,output.folder="ab1_sequences/",file.prefix="150413-51_A01_OPMA1_HCO2198puc")
```

